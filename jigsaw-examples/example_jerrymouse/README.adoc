:icons: font
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
== Example example_jerrymouse

Part of the full xref:../../README.adoc[Java 9 Jigsaw modules example] suite.

[IMPORTANT]
.Authors
====
Originally written by https://github.com/mrtnlhmnn[Martin Lehmann], https://github.com/kristines[Kristine Schaal] and https://github.com/rgrammes[Rüdiger Grammes] (cf. https://github.com/accso/java9-jigsaw-examples[original repository]).

Migrated for JPMS support documentation of Apache Maven^TM^ in the course of the https://open-elements.com/support-care-maven/[Maven Support & Care] program by https://github.com/ascheman[Gerd Aschemann] (and other team members) as https://github.com/support-and-care/java9-jigsaw-examples[forked repository].
Please add discussions, requirements, bugfixes, etc. to the fork instead of the original.
====

== What is this example about?

=== Modules in this example

TODO

=== Example shows ...

TODO

==== Loading Modules in Layers

Starter implements a primitive app server that loads modular applications from the subdirectory apps/ into their own layer under the boot layer and executes them via reflection.

For requirements on modular applications and details on storage, see apps/README.txt

* Applications are stored under apps.
Each application in its own directory "x".
Directory name = application folder name
* Configuration of the application via x/app.json
* The application's modules are located under x/mods/

e.g.

----
apps/example_requires_exports
> app.json
apps/example_requires_exports/mods
> modb.jar
> modc.jar
> modmain.jar
apps/example_hiddenmain
> app.json
apps/example_hiddenmain/mods
> ...
----

* app.json defines the root module as well as the main class and method to be started, e.g.:

[source,json]
----
{
  "rootModule": "modmain",
  "bootClass": "pkgmain.Main",
  "bootMethod": "main"
}
----

Note: "bootMethod" must be static and have String[] as parameter!

END TODO

=== Output

This example uses xref:../../README.adoc#golden-master-testing[golden master testing] to ensure output consistency.
The expected output is compared with actual output using `verify.sh`.

==== Expected Output

[source]
----
include::expected-result/run.txt[]
----

==== Actual Output

[source]
----
include::run-result/run.txt[]
----

==== Maven 4 Output

[source]
----
include::m4/run-result/run.txt[]
----

== Maven 4 Migration

The `example_jerrymouse` has been migrated to Maven 4 with the following approach.

=== Key Changes

Dependency Management::
The `javax.json` automatic module dependency is managed via Maven.
+
* Added `org.glassfish:javax.json:1.0.4` as Maven dependency
* Configured `maven-dependency-plugin` to copy the JAR to `amlib/` directory
* Configured `maven-compiler-plugin` to include `amlib/` on the module-path during compilation

Source Code Sharing::
Uses symbolic links to share source code with the original example.
+
* `m4/src/java/modstarter/main` → `../../../../src/modstarter`

Application Loading::
Created `m4/apps_copyallexamples2appdir.sh` script.
+
* Copies Maven 4 versions of example applications from whitelisted examples
* Builds M4 versions of dependencies if they don't exist yet
* Sources from `../example_*/m4/mlib/` instead of `../example_*/mlib/`
* Creates `app.json` descriptors for each application

Runtime Configuration::
The `m4/run.sh` script runs the JerryMouse app server.
+
* Calls `apps_copyallexamples2appdir.sh` to prepare application JARs
* Runs with correct module-path including `amlib/`
* Dynamically loads and executes applications in separate module layers

=== Applications Loaded

The JerryMouse server loads and runs these Maven 4 migrated examples:

* `example_requires_exports`
* `example_requires_exports-to`
* `example_derived_private-package-protected`

Each application runs in its own module layer with proper isolation.
