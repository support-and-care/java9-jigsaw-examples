:icons: font
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
== Example example_layer-modules-grouped-in-hierarchy

Part of the full xref:../../README.adoc[Java 9 Jigsaw modules example] suite.

[IMPORTANT]
.Authors
====
Originally written by https://github.com/mrtnlhmnn[Martin Lehmann], https://github.com/kristines[Kristine Schaal] and https://github.com/rgrammes[RÃ¼diger Grammes] (cf. https://github.com/accso/java9-jigsaw-examples[original repository]).

Migrated for JPMS support documentation of Apache Maven^TM^ in the course of the https://open-elements.com/support-care-maven/[Maven Support & Care] program by https://github.com/ascheman[Gerd Aschemann] (and other team members) as https://github.com/support-and-care/java9-jigsaw-examples[forked repository].
Please add discussions, requirements, bugfixes, etc. to the fork instead of the original.
====

== What is this example about?

This example is the same as xref:../example_layer-modules-all-in-boot-layer/README.adoc[this example].
The main difference is, that the modules are not all in the boot layer but distributed over a layer hierarchy of the boot layers and 3 child layers.

=== Layers in this example

We have the boot layer as the parent layer for these three child layers:

* `foo layer #1` which contains the module `modfoo` which requires the automatic module `modauto1`
* `bar layer #1` which contains the module `modbar` which requires the automatic module `modauto2`
* `bar layer #2` which contains the module `modbar` which requires the automatic module `modauto2`

The boot layer contains these modules

* `modcommon` which has standard functionality used by all other modules
* `modmain` which does reflective calls to `modbar` and `modfoo`

=== Module Dependency Graph, created with https://github.com/accso/java9-jigsaw-depvis[DepVis]

image::moduledependencies.png[Example's Module Dependency Graph]

Note that this graph has been changed manually as https://github.com/accso/java9-jigsaw-depvis[DepVis] cannot deal with layers for now.

=== Example shows ...

The examples shows what happens, if `modmain/pkgmain.Main` does reflective calls to classes in module `modfoo` or `modbar`, respectively.
Note that these reflective calls from `modmain` to `modfoo` and `modbar` are done from the boot layer to one of its child layers.

More remarks:

* Reflective calls from the parent layer (from `modmain` to `modfoo` and `modbar`) are possible.
* Reflective calls from the parent layer (`modfoo` and `modbar` to `modcommon`) would also be possible.
* `modcommon` is used from `modmain` and `modfoo` and `modbar`.
So it is resolved in the boot layer already.
* The child layers do not have a split package problem, though in `bar layer #1` and `bar layer #2` the same module `modbar` is resolved.
* Also `modbar` and `modfoo` can use different version of the automatic module `modauto1|2`.
No split package problem.

The interesting parts are all done in link:src/modmain/pkgmain/Main.java[`modmain/pkgmain.Main` here in this example].
See its functionality on

* ... how to create child layers and add modules
* ... how to call functionality in child layers

You might also want to look at the differences between link:src/modmain/pkgmain/Main.java[`modmain/pkgmain.Main` here in this example] and
xref:../example_layer-modules-all-in-boot-layer/README.adoc#src/modmain/pkgmain/Main.java[`modmain/pkgmain.Main` in example_layer-modules-all-in-boot-layer].

=== Output

This example uses xref:../../README.adoc#golden-master-testing[golden master testing] to ensure output consistency.
The expected output is compared with actual output using `verify.sh`.

==== Expected Output

[source]
----
include::expected-result/run.txt[]
----

==== Actual Output

[source]
----
include::run-result/run.txt[]
----
